/*!
 * Antinus Innovation
 * All rights reserved
 */
webpackJsonp([1],{524:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=f(r(13)),o=f(r(1)),n=f(r(14)),l=f(r(2)),u=f(r(3)),s=f(r(0)),c=f(r(126)),i=f(r(231)),d=f(r(536));function f(e){return e&&e.__esModule?e:{default:e}}var m=function(e){function t(){return(0,o.default)(this,t),(0,l.default)(this,(t.__proto__||(0,a.default)(t)).apply(this,arguments))}return(0,u.default)(t,e),(0,n.default)(t,[{key:"render",value:function(){return s.default.createElement(d.default,null)}}]),t}(s.default.PureComponent);t.default=(0,c.default)([i.default],m)},536:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i(r(13)),o=i(r(1)),n=i(r(14)),l=i(r(2)),u=i(r(3)),s=i(r(0)),c=i(r(86));function i(e){return e&&e.__esModule?e:{default:e}}var d=0,f=function(e){function t(e){(0,o.default)(this,t);var r=(0,l.default)(this,(t.__proto__||(0,a.default)(t)).call(this,e));return r.chunks=[],r.allClips=[],r.lastVolume=0,r.noSoundFor=0,r.startTalk=!1,r.overAllProcessTime=0,r.state={clips:[]},r.getAudio=function(e){return r.audio=e},r.perpareStreamAnalysis=function(e){var t=new AudioContext,a=t.createMediaStreamSource(e.clone()),o=t.createScriptProcessor();o.onaudioprocess=function(e){var t,a=e.inputBuffer.getChannelData(0),n=a.length,l=0;d++,r.overAllProcessTime++;for(var u=0;u<n;u++)l+=(t=a[u])*t;var s=Math.sqrt(l/n);o.volume+=s},o.volume=0,r.meter=o,a.connect(r.meter),o.connect(t.destination),setInterval(r.streamAnalysis,10)},r.streamAnalysis=function(){if(r.overAllProcessTime){if(!r.startTalk)return r.meter.volume/r.overAllProcessTime>=.05&&(r.startTalk=!0),void(r.overAllProcessTime=r.meter.volume=0);r.meter.volume/r.overAllProcessTime<=.05?(r.noSoundFor+=10,r.noSoundFor>1e3&&r.startTalk&&(r.mergeRecords(),r.startTalk=!1)):r.noSoundFor=0,r.overAllProcessTime=1,r.meter.volume=0}},r.onBlockEnd=function(){r.mediaRecorder.requestData(),r.isLastBlockStop=!1},r.dataProcess=function(e){if(r.chunks.push(e.data),r.requestMerge)if(r.isLastBlockStop){r.requestMerge=!1,r.startRecord(),r.isLastBlockStop=!1;var t=new Blob(r.chunks,{type:"audio/ogg; codecs=opus"});r.chunks=[];var a=URL.createObjectURL(t);r.allClips.push(a),r.audio.src=a}else r.stopReord()},r.startRecord=function(){switch(r.mediaRecorder.state){case"paused":r.mediaRecorder.resume();break;case"inactive":r.mediaRecorder.start();break;default:return}r.handle=setInterval(r.onBlockEnd,600)},r.stopReord=function(){"inactive"!==r.mediaRecorder.state&&(r.mediaRecorder.stop(),clearInterval(r.handle),r.isLastBlockStop=!0)},r.mergeRecords=function(){r.requestMerge=!0,r.noSoundFor=0},r.debug=function(){r.setState({clips:r.allClips}),console.log(d)},r}return(0,u.default)(t,e),(0,n.default)(t,[{key:"componentDidMount",value:function(){var e=this;navigator.mediaDevices.getUserMedia({audio:!0}).then(function(t){e.mediaRecorder=new MediaRecorder(t),e.perpareStreamAnalysis(t.clone()),e.mediaRecorder.ondataavailable=e.dataProcess}).catch(function(e){console.log(e)})}},{key:"render",value:function(){return s.default.createElement(s.default.Fragment,null,s.default.createElement(c.default,{onClick:this.startRecord,text:"开始"}),s.default.createElement(c.default,{onClick:this.mergeRecords,text:"强制合成"}),s.default.createElement(c.default,{onClick:this.stopReord,text:"终止"}),s.default.createElement(c.default,{onClick:this.debug,text:"debug"}),s.default.createElement("div",null,s.default.createElement("span",null,"Main audio"),s.default.createElement("audio",{controls:!0,ref:this.getAudio}),this.state.clips.map(function(e){return s.default.createElement("audio",{key:e,controls:!0,src:e})})))}}]),t}(s.default.Component);t.default=f}});